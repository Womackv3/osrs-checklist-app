<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iron Bible - OSRS Player Dashboard</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- External Stylesheets -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Game Data -->
    <script src="data/quests.js"></script>
    <script src="data/diaries.js"></script>
    <script src="monsters.js?v=2.1"></script>
    <script src="potions.js"></script>
    <script src="locations.js"></script>
    
    <!-- Application Modules -->
    <script src="js/config/firebase.js"></script>
    <script src="js/services/firestore.service.js"></script>
    <script src="js/services/osrs-api.service.js"></script>
    <script src="js/components/diary.component.js"></script>
    <script src="js/components/quest.component.js"></script>
    <script src="js/components/group-iron.component.js"></script>
    <script src="js/compatibility.js"></script>
    <script src="js/main.js"></script>
</head>
<body>
    <!-- Top Header Bar -->
    <header class="top-header">
        <div class="header-title">Iron Bible</div>
        <nav class="header-nav">
            <div id="user-greeting" class="user-greeting">
                Hello, <span id="user-nickname">Adventurer</span>
            </div>
            <div class="hamburger-menu">
                <button class="hamburger-btn" onclick="toggleDropdown()">
                    ‚ò∞
                </button>
                <div id="dropdown-menu" class="dropdown-menu">
                    <button class="dropdown-item" onclick="openProfile()">Profile Settings</button>
                    <button class="dropdown-item" onclick="openImportExport()">Import/Export Data</button>
                    <button class="dropdown-item" onclick="openHelp()">Help & Tutorial</button>
                    <button class="dropdown-item" onclick="openAbout()">About Iron Bible</button>
                    <button class="dropdown-item danger" onclick="logout()">Sign Out</button>
                </div>
            </div>
        </nav>
    </header>
    
    <div class="journal-container">
        <div class="book-pages">
            <!-- Left Page - Interactive Journal -->
            <div class="page left-page">
                <div class="tab-navigation">
                    <button class="tab-button active" data-tab="notes">Notes</button>
                    <button class="tab-button" data-tab="slayer">Slayer</button>
                    <button class="tab-button" data-tab="potions">Potions</button>
                    <button class="tab-button" data-tab="todo">To-Do List</button>
                </div>
                <div class="tab-content-area">
                    <!-- Notes Tab -->
                    <div id="notes" class="tab-content active">
                        <h1>Personal Notes</h1>
                        <textarea id="personal-notes" class="notes-textarea" placeholder="Write your OSRS notes here... (automatically saved)"></textarea>
                        <p style="margin-top: 15px; color: #8b4513; font-style: italic; text-align: center; font-size: 0.9em;">
                            üíæ Your notes are automatically saved as you type
                        </p>
                        <p id="save-status" style="margin-top: 5px; color: #8b4513; font-style: italic; text-align: center; font-size: 0.8em;"></p>
                    </div>

                    <!-- Slayer Tab -->
                    <div id="slayer" class="tab-content">
                        <h1>Slayer Guide</h1>
                        
                        <div class="slayer-container">
                            <div class="slayer-selector">
                                <label for="monster-selector">Choose a Slayer Monster:</label>
                                <select id="monster-selector" class="monster-selector" onchange="updateMonsterInfo()">
                                    <option value="">Select a monster...</option>
                                </select>
                            </div>
                            
                            <div id="monster-info-container" class="monster-info-container">
                                <div id="monster-info" class="monster-info" style="display: none;">
                                    <div class="monster-header">
                                        <h3 id="monster-name"></h3>
                                    </div>
                                    <div class="monster-content">
                                        <div class="monster-section">
                                            <p id="monster-description"></p>
                                        </div>
                                        
                                        <div class="monster-section">
                                            <h4>üíö Hitpoints:</h4>
                                            <p id="monster-hp"></p>
                                        </div>
                                        
                                        <div class="monster-section">
                                            <h4>üõ°Ô∏è Defenses:</h4>
                                            <p id="monster-defenses"></p>
                                        </div>
                                        
                                        <div class="monster-section">
                                            <h4>‚öîÔ∏è Weaknesses:</h4>
                                            <p id="monster-weaknesses"></p>
                                        </div>
                                        
                                        <div class="monster-section">
                                            <h4>üí∞ Notable Drops:</h4>
                                            <p id="monster-drops"></p>
                                        </div>
                                        
                                        <div class="monster-section">
                                            <h4>üìç Location:</h4>
                                            <p id="monster-location"></p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="monster-placeholder" class="monster-placeholder">
                                    <p>Select a monster above to view detailed information</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Potions Tab -->
                    <div id="potions" class="tab-content">
                        <h1>Potion Calculator</h1>
                        
                        <div class="potion-container">
                            <div class="potion-selector">
                                <label for="potion-type">Select Potion Type:</label>
                                <select id="potion-type" class="potion-selector" onchange="updatePotionInfo()">
                                    <option value="">Choose a potion...</option>
                                </select>
                            </div>
                            
                            <div id="potion-info-container" class="potion-info-container">
                                <div id="potion-info" class="potion-info" style="display: none;">
                                    <div class="potion-header">
                                        <h3 id="potion-name"></h3>
                                    </div>
                                    <div class="potion-content">
                                        <div class="potion-section">
                                            <h4>üìñ Description:</h4>
                                            <p id="potion-description"></p>
                                        </div>
                                        
                                        <div class="potion-section">
                                            <h4>üß™ Ingredients:</h4>
                                            <ul id="potion-ingredients" class="ingredient-list"></ul>
                                        </div>
                                        
                                        <div class="potion-section">
                                            <h4>üìà Experience:</h4>
                                            <p id="potion-experience"></p>
                                        </div>
                                        
                                        <div class="potion-calculator">
                                            <h4>üìä Calculator:</h4>
                                            <label for="potion-quantity">Number of potions to make:</label>
                                            <input type="number" id="potion-quantity" min="1" value="1" oninput="calculatePotionResults()">
                                            
                                            <div id="calculation-results" class="calculation-results">
                                                <!-- Results will be populated by JavaScript -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div id="potion-placeholder" class="potion-placeholder">
                                    <p>Select a potion type above to view detailed information and calculator</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- To-Do List Tab -->
                    <div id="todo" class="tab-content">
                        <h1>To-Do List</h1>
                        
                        <!-- Master List Container - Top Half -->
                        <div id="master-list-container">
                            <div id="master-goals-list">
                                <!-- Goals checkboxes will be populated dynamically -->
                                <p style="text-align: center; color: #666; margin-top: 50px;">Loading goals...</p>
                            </div>
                        </div>
                        
                        <!-- Requirements Container - Bottom Half -->
                        <div id="requirements-container">
                            <div class="requirements-tab-navigation">
                                <button class="requirements-tab-button active" onclick="switchRequirementsTab('skills')">üìä Skill Requirements</button>
                                <button class="requirements-tab-button" onclick="switchRequirementsTab('tasks')">üìã Task Steps</button>
                            </div>
                            
                            <!-- Skill Requirements Tab -->
                            <div id="skills-requirements-tab" class="requirements-tab-panel active">
                                <div id="skill-requirements">
                                    <div class="requirements-grid">
                                        <!-- Skills will be populated dynamically to match stats tab layout -->
                                        <p style="text-align: center; color: #666; margin-top: 50px;">Select goals above to see skill requirements</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Task Steps Tab -->
                            <div id="tasks-requirements-tab" class="requirements-tab-panel">
                                <div id="task-steps-list">
                                    <p style="text-align: center; color: #666; margin-top: 50px;">Diary tasks will appear here with detailed steps</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Page - Stats & Tracking -->
            <div class="page right-page">
                <div class="tab-navigation-right">
                    <button class="tab-button-right active" data-tab="stats">Stats</button>
                    <button class="tab-button-right" data-tab="quests">Quests</button>
                    <button class="tab-button-right" data-tab="diaries">Diaries</button>
                    <button class="tab-button-right" data-tab="group-iron">Group Iron</button>
                </div>
                <div class="tab-content-area">
                    <!-- Stats Tab -->
                    <div id="stats" class="tab-content active">
                        <h1>Player Stats</h1>
                        
                        <div class="player-lookup">
                            <div class="lookup-form">
                                <input type="text" id="username-input" placeholder="Enter OSRS username" class="username-input" maxlength="12">
                                <button id="lookup-btn" onclick="lookupPlayer()">Lookup Player</button>
                            </div>
                        </div>

                        <div class="stats-grid">
                            <!-- Attack -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'attack')">
                                <img src="Pictures/attack_icon.png" alt="Attack" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Attack</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Strength -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'strength')">
                                <img src="Pictures/strength_icon.png" alt="Strength" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Strength</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Defence -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'defence')">
                                <img src="Pictures/defence_icon.png" alt="Defence" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Defence</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Ranged -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'ranged')">
                                <img src="Pictures/ranged_icon.png" alt="Ranged" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Ranged</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Prayer -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'prayer')">
                                <img src="Pictures/prayer_icon.png" alt="Prayer" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Prayer</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Magic -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'magic')">
                                <img src="Pictures/magic_icon.png" alt="Magic" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Magic</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Runecraft -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'runecraft')">
                                <img src="Pictures/runecraft_icon.png" alt="Runecraft" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Runecraft</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Construction -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'construction')">
                                <img src="Pictures/construction_icon.png" alt="Construction" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Construction</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Hitpoints -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'hitpoints')">
                                <img src="Pictures/hitpoints_icon.png" alt="Hitpoints" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Hitpoints</div>
                                    <div class="stat-level">10/99</div>
                                </div>
                            </div>
                            
                            <!-- Agility -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'agility')">
                                <img src="Pictures/agility_icon.png" alt="Agility" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Agility</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Herblore -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'herblore')">
                                <img src="Pictures/herblore_icon.png" alt="Herblore" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Herblore</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Thieving -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'thieving')">
                                <img src="Pictures/thieving_icon.png" alt="Thieving" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Thieving</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Crafting -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'crafting')">
                                <img src="Pictures/crafting_icon.png" alt="Crafting" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Crafting</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Fletching -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'fletching')">
                                <img src="Pictures/fletching_icon.png" alt="Fletching" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Fletching</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Slayer -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'slayer')">
                                <img src="Pictures/slayer_icon.png" alt="Slayer" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Slayer</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Hunter -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'hunter')">
                                <img src="Pictures/hunter_icon.png" alt="Hunter" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Hunter</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Mining -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'mining')">
                                <img src="Pictures/mining_icon.png" alt="Mining" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Mining</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Smithing -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'smithing')">
                                <img src="Pictures/smithing_icon.png" alt="Smithing" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Smithing</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Fishing -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'fishing')">
                                <img src="Pictures/fishing_icon.png" alt="Fishing" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Fishing</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Cooking -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'cooking')">
                                <img src="Pictures/cooking_icon.png" alt="Cooking" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Cooking</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Firemaking -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'firemaking')">
                                <img src="Pictures/firemaking_icon.png" alt="Firemaking" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Firemaking</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Woodcutting -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'woodcutting')">
                                <img src="Pictures/woodcutting_icon.png" alt="Woodcutting" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Woodcutting</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                            
                            <!-- Farming -->
                            <div class="stat-item" onclick="openTodoModal('skill', 'farming')">
                                <img src="Pictures/farming_icon.png" alt="Farming" class="stat-icon">
                                <div class="stat-info">
                                    <div class="stat-name">Farming</div>
                                    <div class="stat-level">1/99</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quests Tab -->
                    <div id="quests" class="tab-content">
                        <!-- Quest Main View -->
                        <div id="quest-main-view">
                            <h1>Quest Guide</h1>
                            
                            <div class="quest-filters">
                                <input type="text" id="quest-search" placeholder="Search quests..." class="quest-search">
                                
                                <div class="filter-row">
                                    <select id="difficulty-filter" class="quest-filter">
                                        <option value="all">All Difficulties</option>
                                        <option value="novice">Novice</option>
                                        <option value="intermediate">Intermediate</option>
                                        <option value="experienced">Experienced</option>
                                        <option value="master">Master</option>
                                        <option value="grandmaster">Grandmaster</option>
                                    </select>
                                    
                                    <select id="members-filter" class="quest-filter">
                                        <option value="all">All Quests</option>
                                        <option value="free">Free-to-Play</option>
                                        <option value="members">Members Only</option>
                                    </select>
                                    
                                    <select id="completion-filter" class="quest-filter">
                                        <option value="all">All Quests</option>
                                        <option value="completed">Completed</option>
                                        <option value="incomplete">Not Completed</option>
                                    </select>
                                </div>
                            </div>

                            <div id="quest-list" class="quest-list"></div>
                        </div>

                        <!-- Quest Detail View -->
                        <div id="quest-detail-view" style="display: none;">
                            <div class="quest-detail-header">
                                <button class="back-button" onclick="questComponent.closeQuest()">‚Üê Back to Quests</button>
                                <h1 id="quest-title">Quest Name</h1>
                                <span id="quest-difficulty-badge" class="difficulty-badge">Difficulty</span>
                            </div>
                            
                            <div id="quest-content" class="quest-detail-content">
                                <!-- Quest details populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Diaries Tab -->
                    <div id="diaries" class="tab-content">
                        <!-- Diary Main View -->
                        <div id="diary-main-view">
                            <h1>Achievement Diaries</h1>
                            <div class="diary-list" id="diary-list">
                                <!-- Diary list populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Difficulty Detail View -->
                        <div id="difficulty-detail-view" style="display: none;">
                            <div class="diary-detail-header">
                                <button class="back-button" onclick="diaryComponent.backToDiary()">‚Üê Back to Diary</button>
                                <h1 id="difficulty-title">Diary - Difficulty</h1>
                            </div>
                            
                            <div id="difficulty-content" class="diary-detail-content">
                                <!-- Difficulty details populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Group Iron Tab -->
                    <div id="group-iron" class="tab-content">
                        <h1>Group Iron Stats</h1>
                        
                        <!-- Group Lookup Section -->
                        <div class="group-lookup-section">
                            <div class="lookup-form">
                                <input type="text" id="group-name-input" class="username-input" placeholder="Enter group name..." maxlength="50" onkeypress="handleGroupLookupEnter(event)">
                                <button id="group-lookup-btn" onclick="lookupGroupStats()">Search Group</button>
                            </div>
                        </div>

                        <!-- Group Stats Display -->
                        <div id="group-stats-container" class="group-stats-container" style="display: none;">
                            <!-- Group header will be populated here -->
                            <div id="group-header" class="group-header"></div>
                            
                            <!-- Group members will be populated here -->
                            <div id="group-members" class="group-members"></div>
                        </div>
                        
                        <!-- Loading state -->
                        <div id="group-loading" class="loading-state" style="display: none;">
                            <div class="loading-spinner"></div>
                            <p>Loading group information...</p>
                        </div>
                        
                        <!-- Error state -->
                        <div id="group-error" class="error-state" style="display: none;">
                            <p>Group not found or an error occurred. Please check the group name and try again.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add to To-Do List Modal -->
    <div id="todo-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add to To-Do List</h2>
                <button class="modal-close" onclick="closeTodoModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-item-info">
                    <h3 id="modal-item-name">Item Name</h3>
                    <p id="modal-item-description">Item description will appear here.</p>
                    <div id="modal-item-details"></div>
                </div>
                
                <!-- Skill Level Input (only shown for skills) -->
                <div id="skill-level-input" style="display: none;">
                    <label for="target-level" class="skill-level-label">Target Level:</label>
                    <div class="level-input-container">
                        <input type="number" id="target-level" min="1" max="99" value="99" class="level-input">
                        <span class="level-info">Current: <span id="current-level">1</span></span>
                    </div>
                </div>
                
                <p class="modal-question">Would you like to add this to your To-Do List?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-cancel" onclick="closeTodoModal()">Cancel</button>
                <button class="modal-button modal-confirm" onclick="confirmAddToTodo()">Add to To-Do List</button>
            </div>
        </div>
    </div>

    <!-- Remove from To-Do List Modal -->
    <div id="remove-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Remove from To-Do List</h2>
                <button class="modal-close" onclick="closeRemoveModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-item-info">
                    <h3 id="remove-modal-item-name">Item Name</h3>
                    <p id="remove-modal-item-description">Item description will appear here.</p>
                </div>
                
                <p class="modal-question">Are you sure you want to remove this from your To-Do List?</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button modal-cancel" onclick="closeRemoveModal()">Cancel</button>
                <button class="modal-button modal-confirm modal-remove" onclick="confirmRemoveGoal()">Remove from To-Do List</button>
            </div>
        </div>
    </div>

    <script>
    // Basic functionality that needs to be in the HTML file
    
    function toggleDropdown() {
        const dropdown = document.getElementById('dropdown-menu');
        dropdown.classList.toggle('show');
    }

    // Placeholder functions for dropdown actions
    function openProfile() { console.log('Profile settings not yet implemented'); }
    function openImportExport() { console.log('Import/Export not yet implemented'); }
    function openHelp() { console.log('Help not yet implemented'); }
    function openAbout() { console.log('About not yet implemented'); }
    function logout() { console.log('Logout not yet implemented'); }

    // Monster info functions - implemented in js/compatibility.js

    // Potion functions - implemented in js/compatibility.js

    // Todo functions (placeholder)
    function openCustomGoalModal() { console.log('Custom goal modal not yet implemented'); }
    function clearCompletedGoals() { console.log('Clear completed goals not yet implemented'); }
    </script>
</body>
</html>